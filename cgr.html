<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <title> CGR </title>
  <meta name="Author" content="Jonas Almeida">
  <meta name="Keywords" content="CGR">
  <meta name="Description" content="Chaos Game Representation">
  <script src="usm.js"></script>
 </head>

 <body>
 <h3>1. Sequence</h3>
 <table>
 <tr id="cgrBase"><td>Base Sequence:</td><td><input id="baseSequence" type="text" style="color:blue"><button id="processBase" onclick="usmGUI.processBaseSequence()">Process </button></td></tr>
 <tr id="cgrProbe" style="display:none"><td>Probe Sequence:</td><td><input id="probeSequence" type="text" style="color:red"><button id="processProbe" onclick="usmGUI.processProbeSequence()">Process</button></td></tr>
 </table>
 <h3>2. Encoding / Decoding</h3>
 
 <table id="baseCube" style="display:none">
 <tr><td>Alphabet: </td><td id="alphabet" style="color:blue"></td></tr>
 <tr><td>CGR cube zero: </td><td id="cube" style="color:blue"></td></tr>
 </table>
 
 <h3>3. Sequence analysis (map)</h3>
 
 <table id="mapTable" style="display:none;color:blue">
 </table>
  <script>
  document.getElementById('baseSequence').value=document.location.search.slice(1);
  gId=function(id){return document.getElementById(id)};
  tr = function(){return document.createElement('tr')};
  td = function(){return document.createElement('td')};
  tbody = function(){return document.createElement('tbody')};
  usmGUI=function(){};

  usmGUI.processBaseSequence=function(){
     var seq=gId('baseSequence').value;
	 console.log('processing base sequence "'+seq+'"');
	 ubase=new usm(seq);
	 // show cube
	 c = document.getElementById('baseCube');
	 c.style.display="";
	 gId('alphabet').textContent=ubase.abc;
	 gId('cube').textContent='[ "'+ubase.cube[0]+'"';
	 for(var i=1;i<ubase.cube.length;i++){gId('cube').textContent+=' , "'+ubase.cube[i]+'"'}
	 gId('cube').textContent+=' ]';
	 gId('cgrProbe').style.display="";
	 gId('processBase').style.visibility="hidden";
	 gId('probeSequence').focus();
	 usmGUI.mapTableBase();
	 return false;
  }
  
  usmGUI.mapTableBase=function(){
	 var tb,tbodyi,tri,tdi,n,m,i,j;
     tb=gId('mapTable');
	 tb.style.display="";
	 n=ubase.seq.length;
	 m=ubase.cube.length;
	 tbodyi = tbody();tb.appendChild(tbodyi);
	 // Table head
	 tri = tr();tbodyi.appendChild(tri);
	 tdi = td();tri.appendChild(tdi);tdi.textContent='forward';
	 tdi = td();tri.appendChild(tdi);tdi.textContent='backward';
	 tdi = td();tri.appendChild(tdi);tdi.textContent='seq';
	 for (i=0;i<n;i++){
	    tri = tr();tbodyi.appendChild(tri);
	    tdi = td();tri.appendChild(tdi);
		tdi.textContent='['+ubase.cgrForward[i][0].toString().slice(0,4);
		for (j=1;j<m;j++){tdi.textContent+=','+ubase.cgrForward[i][j].toString().slice(0,4)}
		tdi.textContent+=']';
	    tdi = td();tri.appendChild(tdi);
		tdi.textContent='['+ubase.cgrBackward[i][0].toString().slice(0,4);
		for (j=1;j<m;j++){tdi.textContent+=','+ubase.cgrBackward[i][j].toString().slice(0,4)}
		tdi.textContent+=']';
	    tdi = td();tri.appendChild(tdi);tdi.textContent=ubase.seq[i];
	 
	 }
  }

usmGUI.processProbeSequence=function(){
     var seq=gId('probeSequence').value;
	 console.log('processing probe sequence "'+seq+'"');
	 uprobe=new usm(seq,ubase.abc,ubase.pack); // encode the probe sequence the same way as teh base sequence

	 // show cube
	 //c = document.getElementById('baseCube');
	 //c.style.display="";
	 //gId('alphabet').textContent=ubase.abc;
	 //gId('cube').textContent='[ "'+ubase.cube[0]+'"';
	 //for(var i=1;i<ubase.cube.length;i++){gId('cube').textContent+=' , "'+ubase.cube[i]+'"'}
	 //gId('cube').textContent+=' ]';
	 //gId('cgrProbe').style.display="";
	 //gId('processBase').style.visibility="hidden";
	 //gId('probeSequence').focus();
	 //usmGUI.mapTableBase();
	 return false;
  }

  usmGUI.mapTableAll=function(){
	 var tb,tbodyi,tri,tdi,n,m,i,j;
     tb=gId('mapTable');
	 tb.style.display="";
	 n=ubase.seq.length;
	 m=ubase.cube.length;
	 tbodyi = tbody();tb.appendChild(tbodyi);
	 // Table head
	 tri = tr();tbodyi.appendChild(tri);
	 tdi = td();tri.appendChild(tdi);tdi.textContent='forward';
	 tdi = td();tri.appendChild(tdi);tdi.textContent='backward';
	 tdi = td();tri.appendChild(tdi);tdi.textContent='seq';
	 for (i=0;i<n;i++){
	    tri = tr();tbodyi.appendChild(tri);
	    tdi = td();tri.appendChild(tdi);
		tdi.textContent='['+ubase.cgrForward[i][0].toString().slice(0,4);
		for (j=1;j<m;j++){tdi.textContent+=','+ubase.cgrForward[i][j].toString().slice(0,4)}
		tdi.textContent+=']';
	    tdi = td();tri.appendChild(tdi);
		tdi.textContent='['+ubase.cgrBackward[i][0].toString().slice(0,4);
		for (j=1;j<m;j++){tdi.textContent+=','+ubase.cgrBackward[i][j].toString().slice(0,4)}
		tdi.textContent+=']';
	    tdi = td();tri.appendChild(tdi);tdi.textContent=ubase.seq[i];
	 
	 }
  }



  gId('processBase').click();
  </script>
 </body>
</html>
